# Как устроена аналитика Авиасейлс

Ежедневно на Авиасейлс происходит около **7 миллионов поисков**. И помимо кор-функциональности поиска авиабилетов у нас есть множество других фич и даже бизнес-направлений (B2B, аффилиатская программа Travelpayouts, Aviastats и другие).

Как продуктовая компания мы везде собираем данные и фиксируем пользовательские события. В день их больше **170 миллионов**. Мы также следим за работой системы, пишем логи и тесты. В сумме за сутки мы накапливаем около **1 ТБ данных**. Представьте, сколько их собралось за 18 лет работы (подсказка: более **500 ТБ**).

## Команда аналитики в Авиасейлс

- Более **70 человек**.  
- Среди специалистов есть продуктовые аналитики, дата-аналитики, бизнес-аналитики, BI-аналитики, дата-инженеры, ML-инженеры.  
- Работаем как в функциональных командах, так и в кросс-функциональных.  
- Вне зависимости от структуры команды поддерживаем общение c другими аналитиками на регулярных демо и в общем чате.

## Продуктовая аналитика в Авиасейлс

Мы решаем много задач:

**Delivery:** поддерживаем процессы внесения изменений в продукт со всех сторон, дизайним и проводим много A/Б-тестов, а когда запустить A/Б нельзя – используем альтернативные способы проверки гипотез (например, *Causal Impact*).

**Discovery:** проводим аналитические исследования, помогаем продактам принимать решения по развитию продукта и делать новые фичи, часто сами приходим с идеями и рекомендациями. **Для нас аналитик – это не калькулятор или инструмент по выгрузке данных, а полноценный партнёр в принятии решений**. Например, именно по инициативе аналитиков у нас в продукте были запущены ML-скоринг авиабилетов в поисковой выдаче и рекомендации направлений в форме поиска.

**BI и мониторинг:** придумываем новые метрики и строим из них деревья метрик, делаем удобные дашборды и отчёты, автоматически детектим и алёртим аномалии в метриках. Занимаемся мониторингом как на уровне конкретной команды, так и на уровне всего продукта.

**Сегментация:** разрабатываем подходы к сегментации пользователей на основе их поведения и характеристик, помогаем принимать более точные продуктовые решения, фокусируясь на потребностях конкретных сегментов.

## Инфраструктура данных в Авиасейлс

Хранением, преобразованием и поставкой данных занимается команда дата-инженеров. Им слово:

> Для аналитиков мы создаём инструменты, которые позволяют решать их повседневные задачи разного уровня сложности: от ad-hoc запросов до многофункциональных ML-моделей.

### Команда

- 14 человек в команде.  
- Мы придерживаемся подхода **Data Mesh**: продуктовые команды несут ответственность за свои данные и развивают экспертизу в использовании аналитической дата-платформы. Во многих командах есть выделенный дата-инженер. Где-то часть работы делает аналитик.  
- Но часть команды занимается развитием платформы: доставкой и обработкой данных и обеспечением взаимодействия со внутренними пользователями.

### Архитектура

- Наша дата-платформа построена по принципам **Lakehouse-архитектуры**.  
- Используем облачное object storage-хранилище.  
- Архитектура изначально cloud-agnostic — мы не привязаны к конкретному облаку.  
- Храним данные в Parquet и Delta Lake формате.  
- Для оптимизации расходов критически важные данные архивируются в S3 Glacier.

### Стек

- Загрузка данных в хранилище — **Apache Spark Streaming** на Scala и **DLT** на Python.  
- **DuckDB** для reverse-etl задач.  
- Трансформации — через **DBT** + Apache Spark.  
- Оркестрация пайплайнов — **Apache Airflow**, у нас больше **2000 DAG’ов**.  
- Интерактивные запросы — через **Trino** и Spark.  
- Каталог данных на базе **DataHub**.  
- BI-инструменты: несколько решений для визуализации, а также **JupyterHub** для ресёрчей, гибридных задач и ML-процессов.

## Мы в публичном пространстве

[Доклад](https://www.youtube.com/watch?v=MSI_iwcIZYE&list=PLKABuGKQeKUdo43EZklvlLVvM-XNH3ESs&index=8) нашего продуктового аналитика Артёма Пономарёва о том, как исследовать эффективность продукта, если нельзя провести А/Б.  

[Библиотека](https://github.com/aviasales/ABiasales?tab=readme-ov-file) для автоматизированного анализа экспериментов от Олега Яксина, хеда бизнес-перфоманс аналитики.

## Работа аналитиком в Авиасейлс: 
- [Дата аналитик](https://www.aviasales.ru/about/vacancies/3976108) в команду поисковой выдачи.
- [Продуктовый аналитик](https://www.aviasales.ru/about/vacancies/3994847) в Travelpayouts — партнёрскую платформу от создателей Авиасейлс, специализирующуюся на монетизации тревел-трафика.